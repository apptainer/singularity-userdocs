

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Environment and Metadata &mdash; Singularity container 2.5.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reproducible SCI-F Apps" href="reproducible_scif_apps.html" />
    <link rel="prev" title="Container Checks" href="container_checks.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Singularity container
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_a_container.html">Build a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_environment.html">Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="container_recipes.html">Container Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity_flow.html">Singularity Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="bind_paths_and_mounts.html">Bind Paths and Mounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistent_overlays.html">Persistent Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_services.html">Running Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="container_checks.html">Container Checks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Environment and Metadata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment">Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#labels">Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#container-metadata">Container Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reproducible_scif_apps.html">Reproducible SCI-F Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity_and_docker.html">Singularity and Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Singularity container</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Environment and Metadata</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/singularityware/singularity-userdocs/blob/master/environment_and_metadata.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="environment-and-metadata">
<span id="id1"></span><h1>Environment and Metadata<a class="headerlink" href="#environment-and-metadata" title="Permalink to this headline">¶</a></h1>
<p id="sec-envandmetadata">Singularity containers support environment variables and labels that you
can add to your container during the build process. This page details
general information about defining environments and labels. If you are
looking for specific environment variables for build time, see build
environment.</p>
<div class="section" id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<p>If you build a container from Singularity Hub or Docker Hub, the
environment will be included with the container at build time. You can
also define custom environment variables in your Recipe file like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: shub

From: vsoch/hello-world


%environment

    VARIABLE_NAME=VARIABLE_VALUE

    export VARIABLE_NAME
</pre></div>
</div>
<p>You may need to add environment variables to your container during the
<code class="docutils literal notranslate"><span class="pre">%post</span></code> section. For instance, maybe you will not know the appropriate
value of a variable until you have installed some software.
To add variables to the environment during <code class="docutils literal notranslate"><span class="pre">%post</span></code> you can use the
<code class="docutils literal notranslate"><span class="pre">$SINGULARITY_ENVIRONMENT</span></code> variable with the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%post

    echo &#39;export VARIABLE_NAME=VARIABLE_VALUE&#39; &gt;&gt;$SINGULARITY_ENVIRONMENT
</pre></div>
</div>
<p>Text in the <code class="docutils literal notranslate"><span class="pre">%environment</span></code> section will be appended to the file <code class="docutils literal notranslate"><span class="pre">/.singularity.d/env/90-environment.sh</span></code> while text redirected
to <code class="docutils literal notranslate"><span class="pre">$SINGULARITY_ENVIRONMENT</span></code> will end up in the file /.singularity.d/env/91-environment.sh.</p>
<p>Because files in <code class="docutils literal notranslate"><span class="pre">/.singularity.d/env</span></code> are sourced in alpha-numerical order, this means that
variables added using <code class="docutils literal notranslate"><span class="pre">$SINGULARITY_ENVIRONMENT</span></code> take precedence over those added via the <code class="docutils literal notranslate"><span class="pre">%environment</span></code>
section.</p>
<p>Need to define a variable at runtime? You can set variables inside the
container by prefixing them with <code class="docutils literal notranslate"><span class="pre">SINGULARITYENV_</span></code>. They will be
transposed automatically and the prefix will be stripped. For example,
let’s say we want to set the variable <code class="docutils literal notranslate"><span class="pre">HELLO</span></code> to have value <code class="docutils literal notranslate"><span class="pre">WORLD</span></code>. We can do that
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ SINGULARITYENV_HELLO=WORLD singularity exec --cleanenv centos7.img env

HELLO=WORLD

LD_LIBRARY_PATH=:/usr/local/lib:/usr/local/lib64

SINGULARITY_NAME=test.img

PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

PWD=/home/gmk/git/singularity

LANG=en_US.UTF-8

SHLVL=0

SINGULARITY_INIT=1

SINGULARITY_CONTAINER=test.img
</pre></div>
</div>
<p>Notice the <code class="docutils literal notranslate"><span class="pre">--cleanenv</span></code> in the example above? That argument specifies that we want
to remove the host environment from the container. If we remove the <code class="docutils literal notranslate"><span class="pre">--cleanenv</span></code>,
we will still pass forward <code class="docutils literal notranslate"><span class="pre">HELLO=WORLD</span></code>, and the list shown above, but we will
also pass forward all the other environment variables from the host.</p>
<p>If you need to change the $PATH of your container at runtime there are
a few environmental variables you can use:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SINGULARITYENV_PREPEND_PATH=/good/stuff/at/beginning</span></code> to prepend directories to the beginning of the</li>
<li><code class="docutils literal notranslate"><span class="pre">SINGULARITYENV_APPEND_PATH=/good/stuff/at/end</span></code> to append directories to the end of the</li>
<li><code class="docutils literal notranslate"><span class="pre">SINGULARITYENV_PATH=/a/new/path</span></code> to override the <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> within the container</li>
</ul>
</div>
<div class="section" id="labels">
<h2>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h2>
<p>Your container stores metadata about it’s build, along with Docker
labels, and custom labels that you define during build in a <code class="docutils literal notranslate"><span class="pre">%labels</span></code> section.</p>
<p>For containers that are generated with Singularity version 2.4 and
later, labels are represented using the <a class="reference external" href="http://label-schema.org/rc1/">rc1 Label Schema</a>. For
example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect dino.img

{

    &quot;org.label-schema.usage.singularity.deffile.bootstrap&quot;: &quot;docker&quot;,

    &quot;MAINTAINER&quot;: &quot;Vanessasaurus&quot;,

    &quot;org.label-schema.usage.singularity.deffile&quot;: &quot;Singularity.help&quot;,

    &quot;org.label-schema.usage&quot;: &quot;/.singularity.d/runscript.help&quot;,

    &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,

    &quot;org.label-schema.usage.singularity.deffile.from&quot;: &quot;ubuntu:latest&quot;,

    &quot;org.label-schema.build-date&quot;: &quot;2017-07-28T22:59:17-04:00&quot;,

    &quot;org.label-schema.usage.singularity.runscript.help&quot;: &quot;/.singularity.d/runscript.help&quot;,

    &quot;org.label-schema.usage.singularity.version&quot;: &quot;2.3.1-add/label-schema.g00f040f&quot;,

    &quot;org.label-schema.build-size&quot;: &quot;715MB&quot;

}
</pre></div>
</div>
<p>You will notice that the one label doesn’t belong to the label schema, <code class="docutils literal notranslate"><span class="pre">MAINTAINER</span></code> .
This was a user provided label during bootstrap. Finally, for
Singularity versions &gt;= 2.4, the image build size is added as a label, <code class="docutils literal notranslate"><span class="pre">org.label-schema.build-size</span></code>,
and the label schema is used throughout. For versions earlier than 2.4,
containers did not use the label schema, and looked like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity exec centos7.img cat /.singularity.d/labels.json

{ &quot;name&quot;:

      &quot;CentOS Base Image&quot;,

       &quot;build-date&quot;: &quot;20170315&quot;,

       &quot;vendor&quot;: &quot;CentOS&quot;,

       &quot;license&quot;: &quot;GPLv2&quot;

}
</pre></div>
</div>
<p>You can add custom labels to your container in a bootstrap file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: docker

From: ubuntu: latest



%labels

AUTHOR Vanessasaur
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">inspect</span></code> command is useful for viewing labels and other container meta-data.</p>
</div>
<div class="section" id="container-metadata">
<h2>Container Metadata<a class="headerlink" href="#container-metadata" title="Permalink to this headline">¶</a></h2>
<p>Inside of the container, metadata is stored in the <code class="docutils literal notranslate"><span class="pre">/.singularity.d</span></code> directory. You
probably shouldn’t edit any of these files directly but it may be
helpful to know where they are and what they do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/.singularity.d/


├── actions

│   ├── exec

│   ├── run

│   ├── shell

│   ├── start

│   └── test

├── env

│   ├── 01-base.sh

│   ├── 90-environment.sh

│   ├── 95-apps.sh

│   └── 99-base.sh

├── labels.json

├── libs

├── runscript

├── Singularity

└── startscript
</pre></div>
</div>
<ul class="simple">
<li><strong>actions</strong>: This directory contains helper scripts to allow the
container to carry out the action commands.</li>
<li><strong>env</strong>: All *.sh files in this directory are sourced in
alpha-numeric order when the container is initiated. For legacy
purposes there is a symbolic link called <code class="docutils literal notranslate"><span class="pre">/environment</span></code> that points to <code class="docutils literal notranslate"><span class="pre">/.singularity.d/env/90-environment.sh</span></code>.</li>
<li><strong>labels.json</strong>: The json file that stores a containers labels
described above.</li>
<li><strong>libs</strong>: At runtime the user may request some host-system libraries
to be mapped into the container (with the <code class="docutils literal notranslate"><span class="pre">--nv</span></code> option for example). If so,
this is their destination.</li>
<li><strong>runscript</strong>: The commands in this file will be executed when the
container is invoked with the <code class="docutils literal notranslate"><span class="pre">run</span></code> command or called as an executable. For
legacy purposes there is a symbolic link called <code class="docutils literal notranslate"><span class="pre">/singularity</span></code> that points to this
file</li>
<li><strong>Singularity</strong>: This is the Recipe file that was used to generate
the container. If more than 1 Recipe file was used to generate the
container additional Singularity files will appear in numeric order
in a sub-directory called <code class="docutils literal notranslate"><span class="pre">bootstrap_history</span></code></li>
<li><strong>startscript</strong>: The commands in this file will be executed when the
container is invoked with the <code class="docutils literal notranslate"><span class="pre">instance.start</span></code> command.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reproducible_scif_apps.html" class="btn btn-neutral float-right" title="Reproducible SCI-F Apps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="container_checks.html" class="btn btn-neutral" title="Container Checks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Singularity.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.5.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>