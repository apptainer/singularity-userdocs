

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Appendix &mdash; Singularity container 2.6.0 documentation</title>




    <link rel="shortcut icon" href="_static/favicon.png"/>



  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Troubleshooting" href="troubleshooting.html" />


  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="index.html" class="icon icon-home"> Singularity container




            <img src="_static/logo.png" class="logo" alt="Logo"/>

          </a>




              <div class="version">
                2.6.0
              </div>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_a_container.html">Build a Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_environment.html">Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="container_recipes.html">Container Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity_flow.html">Singularity Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="bind_paths_and_mounts.html">Bind Paths and Mounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistent_overlays.html">Persistent Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_services.html">Running Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="container_checks.html">Container Checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_and_metadata.html">Environment and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="reproducible_scif_apps.html">Reproducible SCI-F Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity_and_docker.html">Singularity and Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-docker-module">build-docker-module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keywords">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-shub">build-shub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sec-build-shub">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-localimage">build-localimage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-yum">build-yum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-debootstrap">build-debootstrap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-arch">build-arch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-busybox">build-busybox</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-zypper">build-zypper</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Keywords</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#singularity-action-flags">Singularity Action Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#commands">Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-usage">Command Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-singularity-command">The Singularity command</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#options-and-argument-processing">Options and argument processing</a></li>
<li class="toctree-l5"><a class="reference internal" href="#singularity-help">Singularity Help</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#commands-usage">Commands Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#support">Support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build">build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id31">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#download-an-existing-container-from-singularity-hub-or-docker-hub">Download an existing container from Singularity Hub or Docker Hub</a></li>
<li class="toctree-l5"><a class="reference internal" href="#create-writable-images-and-sandbox-directories">Create –writable images and –sandbox directories</a></li>
<li class="toctree-l5"><a class="reference internal" href="#convert-containers-from-one-format-to-another">Convert containers from one format to another</a></li>
<li class="toctree-l5"><a class="reference internal" href="#build-a-container-from-a-singularity-recipe">Build a container from a Singularity recipe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exec">exec</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id33">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#printing-the-os-release-inside-the-container">Printing the OS release inside the container</a></li>
<li class="toctree-l5"><a class="reference internal" href="#printing-the-os-release-for-a-running-instance">Printing the OS release for a running instance</a></li>
<li class="toctree-l5"><a class="reference internal" href="#runtime-flags">Runtime Flags</a></li>
<li class="toctree-l5"><a class="reference internal" href="#special-characters">Special Characters</a></li>
<li class="toctree-l5"><a class="reference internal" href="#a-python-example">A Python example</a></li>
<li class="toctree-l5"><a class="reference internal" href="#a-gpu-example">A GPU example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inspect">inspect</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#json-api-standard">JSON Api Standard</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inspect-flags">Inspect Flags</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#labels">Labels</a></li>
<li class="toctree-l5"><a class="reference internal" href="#runscript">Runscript</a></li>
<li class="toctree-l5"><a class="reference internal" href="#help">Help</a></li>
<li class="toctree-l5"><a class="reference internal" href="#environment">Environment</a></li>
<li class="toctree-l5"><a class="reference internal" href="#test">Test</a></li>
<li class="toctree-l5"><a class="reference internal" href="#deffile">Deffile</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pull">pull</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#singularity-hub">Singularity Hub</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#how-do-tags-work">How do tags work?</a></li>
<li class="toctree-l5"><a class="reference internal" href="#image-names">Image Names</a></li>
<li class="toctree-l5"><a class="reference internal" href="#custom-name">Custom Name</a></li>
<li class="toctree-l5"><a class="reference internal" href="#name-by-commit">Name by commit</a></li>
<li class="toctree-l5"><a class="reference internal" href="#name-by-hash">Name by hash</a></li>
<li class="toctree-l5"><a class="reference internal" href="#pull-to-different-folder">Pull to different folder</a></li>
<li class="toctree-l5"><a class="reference internal" href="#pull-by-commit">Pull by commit</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id34">Docker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run">run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id35">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">Runtime Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#defining-the-runscript">Defining the Runscript</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#shell">shell</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#change-your-shell">Change your shell</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#bash">Bash</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#shell-help">Shell Help</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#image-command-group">Image Command Group</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-export">image.export</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-expand">image.expand</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#increasing-the-size-of-an-existing-image">Increasing the size of an existing image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#image-import">image.import</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-create">image.create</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-new-blank-singularity-container-image">Creating a new blank Singularity container image</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#overwriting-an-image-with-a-new-one">Overwriting an image with a new one</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#instance-command-group">Instance Command Group</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#instance-start">instance.start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id43">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#start-an-instance-called-cow1-from-a-container-on-singularity-hub">Start an instance called cow1 from a container on Singularity Hub</a></li>
<li class="toctree-l5"><a class="reference internal" href="#start-an-interactive-shell-within-the-instance-that-you-just-started">Start an interactive shell within the instance that you just started</a></li>
<li class="toctree-l5"><a class="reference internal" href="#execute-the-runscript-within-the-instance">Execute the runscript within the instance</a></li>
<li class="toctree-l5"><a class="reference internal" href="#run-a-command-within-a-running-instance">Run a command within a running instance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#instance-list">instance.list</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id45">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id46">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#start-a-few-named-instances-from-containers-on-singularity-hub">Start a few named instances from containers on Singularity Hub</a></li>
<li class="toctree-l5"><a class="reference internal" href="#list-running-instances">List running instances</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#instance-stop">instance.stop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id47">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id48">Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id49">Start a few named instances from containers on Singularity Hub</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stop-a-single-instance">Stop a single instance</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stop-all-running-instances">Stop all running instances</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deprecated">Deprecated</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bootstrap">bootstrap</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quick-start">Quick Start</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Singularity container</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content style-external-links">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="index.html">Docs</a> &raquo;</li>

      <li>Appendix</li>


      <li class="wy-breadcrumbs-aside">



              <a href="https://github.com/singularityware/singularity-userdocs/blob/master/appendix.rst" class="fa fa-github"> Edit on GitHub</a>



      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <div class="section" id="appendix">
<h1>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h1>
<div class="section" id="build-docker-module">
<span id="id1"></span><h2>build-docker-module<a class="headerlink" href="#build-docker-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<span id="sec-build-docker-module"></span><h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>Docker images are comprised of layers that are assembled at runtime to create an image. You can use Docker layers to create a base
image, and then add your own custom software. For example, you might use Docker’s Ubuntu image layers to create an Ubuntu Singularity
container. You could do the same with CentOS, Debian, Arch, Suse, Alpine, BusyBox, etc.</p>
<p>Or maybe you want a container that already has software installed. For instance, maybe you want to build a container that uses CUDA
and cuDNN to leverage the GPU, but you don’t want to install from scratch. You can start with one of the <code class="docutils literal notranslate"><span class="pre">nvidia/cuda</span></code> containers and
install your software on top of that.</p>
<p>Or perhaps you have already invested in Docker and created your own Docker containers. If so, you can seamlessly convert them to
Singularity with the <code class="docutils literal notranslate"><span class="pre">docker</span></code> bootstrap module.</p>
</div>
<div class="section" id="keywords">
<h3>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: docker
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>From: &lt;registry&gt;/&lt;namespace&gt;/&lt;container&gt;:&lt;tag&gt;@&lt;digest&gt;
</pre></div>
</div>
<p>The From keyword is mandatory. It specifies the container to use as a base. <code class="docutils literal notranslate"><span class="pre">registry</span></code> is optional and defaults to <code class="docutils literal notranslate"><span class="pre">index.docker.io</span></code>.
<code class="docutils literal notranslate"><span class="pre">namespace</span></code> is optional and defaults to <code class="docutils literal notranslate"><span class="pre">library</span></code>. This is the correct namespace to use for some official containers (ubuntu for example).
<code class="docutils literal notranslate"><span class="pre">tag</span></code> is also optional and will default to <code class="docutils literal notranslate"><span class="pre">latest</span></code></p>
<p>See <a class="reference internal" href="singularity_and_docker.html#singularity-and-docker"><span class="std std-ref">Singularity and Docker</span></a> for more detailed info on using Docker registries.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Registry: http://custom_registry
</pre></div>
</div>
<p>The Registry keyword is optional. It will default to <code class="docutils literal notranslate"><span class="pre">index.docker.io</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Namespace: namespace
</pre></div>
</div>
<p>The Namespace keyword is optional. It will default to <code class="docutils literal notranslate"><span class="pre">library</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>IncludeCmd: yes
</pre></div>
</div>
<p>The IncludeCmd keyword is optional. If included, and if a <code class="docutils literal notranslate"><span class="pre">%runscript</span></code> is not specified, a Docker <code class="docutils literal notranslate"><span class="pre">CMD</span></code> will take precedence over <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code>
and will be used as a runscript. Note that the <code class="docutils literal notranslate"><span class="pre">IncludeCmd</span></code> keyword is considered valid if it is not empty! This means that</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">IncludeCmd:</span> <span class="pre">yes</span></code> and <code class="docutils literal notranslate"><span class="pre">IncludeCmd:</span> <span class="pre">no</span></code> are identical. In both cases the <code class="docutils literal notranslate"><span class="pre">IncludeCmd</span></code> keyword is not empty, so the Docker <code class="docutils literal notranslate"><span class="pre">CMD</span></code> will take precedence
over an <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code>.</p>
<p>See <a class="reference internal" href="singularity_and_docker.html#singularity-and-docker"><span class="std std-ref">Singularity and Docker</span></a> for more info on order of operations for determining a runscript.</p>
</div></blockquote>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>Docker containers are stored as a collection of tarballs called layers. When building from a Docker container the layers must be downloaded and then
assembled in the proper order to produce a viable file system. Then the file system must be converted to squashfs or ext3 format.</p>
<p>Building from Docker Hub is not considered reproducible because if any of the layers of the image are changed, the container will change.
If reproducibility is important to you, consider hosting a base container on Singularity Hub and building from it instead.</p>
<p>For detailed information about setting your build environment see <a class="reference internal" href="build_environment.html#build-environment"><span class="std std-ref">Build Customization</span></a>.</p>
</div>
</div>
<div class="section" id="build-shub">
<span id="id2"></span><h2>build-shub<a class="headerlink" href="#build-shub" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sec-build-shub">
<span id="id3"></span><h3>Overview<a class="headerlink" href="#sec-build-shub" title="Permalink to this headline">¶</a></h3>
<p>You can use an existing container on Singularity Hub as your “base,” and then add customization. This allows you to build multiple images
from the same starting point. For example, you may want to build several containers with the same custom python installation, the same custom
compiler toolchain, or the same base MPI installation. Instead of building these from scratch each time, you could create a base container on
Singularity Hub and then build new containers from that existing base container adding customizations in <code class="docutils literal notranslate"><span class="pre">%post</span></code> , <code class="docutils literal notranslate"><span class="pre">%environment</span></code>, <code class="docutils literal notranslate"><span class="pre">%runscript</span></code>, etc.</p>
</div>
<div class="section" id="id4">
<h3>Keywords<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: shub
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>From: shub://&lt;registry&gt;/&lt;username&gt;/&lt;container-name&gt;:&lt;tag&gt;@digest
</pre></div>
</div>
<p>The From keyword is mandatory. It specifies the container to use as a base. <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">is</span> <span class="pre">optional</span> <span class="pre">and</span> <span class="pre">defaults</span> <span class="pre">to</span> <span class="pre">``singularity-hub.org</span></code>.
<code class="docutils literal notranslate"><span class="pre">tag</span></code> and <code class="docutils literal notranslate"><span class="pre">digest</span></code> are also optional. <code class="docutils literal notranslate"><span class="pre">tag</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">latest</span></code> and <code class="docutils literal notranslate"><span class="pre">digest</span></code> can be left blank if you want the latest build.</p>
</div>
<div class="section" id="id5">
<h3>Notes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>When bootstrapping from a Singularity Hub image, all previous definition files that led to the creation of the current image will be stored
in a directory within the container called <code class="docutils literal notranslate"><span class="pre">/.singularity.d/bootstrap_history</span></code>. Singularity will also alert you if environment variables have
been changed between the base image and the new image during bootstrap.</p>
</div>
</div>
<div class="section" id="build-localimage">
<span id="id6"></span><h2>build-localimage<a class="headerlink" href="#build-localimage" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-localimage">This module allows you to build a container from an existing Singularity container on your host system. The name is somewhat misleading
because your container can be in either image or directory format.</p>
<div class="section" id="id7">
<h3>Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>You can use an existing container image as your “base,” and then add customization. This allows you to build multiple images from the same
starting point. For example, you may want to build several containers with the same custom python installation, the same custom compiler
toolchain, or the same base MPI installation. Instead of building these from scratch each time, you could start with the appropriate local
base container and then customize the new container in <code class="docutils literal notranslate"><span class="pre">%post</span></code>, <code class="docutils literal notranslate"><span class="pre">%environment</span></code>, <code class="docutils literal notranslate"><span class="pre">%runscript</span></code>, etc.</p>
</div>
<div class="section" id="id8">
<h3>Keywords<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: localimage
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>From: /path/to/container/file/or/directory
</pre></div>
</div>
<p>The From keyword is mandatory. It specifies the local container to use as a base.</p>
</div>
<div class="section" id="id9">
<h3>Notes<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>When building from a local container, all previous definition files that led to the creation of the current container will be stored in a
directory within the container called <code class="docutils literal notranslate"><span class="pre">/.singularity.d/bootstrap_history</span></code>. Singularity will also alert you if environment variables have been
changed between the base image and the new image during bootstrap.</p>
</div>
</div>
<div class="section" id="build-yum">
<span id="id10"></span><h2>build-yum<a class="headerlink" href="#build-yum" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-yum">This module allows you to build a Red Hat/CentOS/Scientific Linux style container from a mirror URI.</p>
<div class="section" id="id11">
<h3>Overview<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">yum</span></code> module to specify a base for a CentOS-like container. You must also specify the URI for the mirror you would like to use.</p>
</div>
<div class="section" id="id12">
<h3>Keywords<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: yum
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>OSVersion: 7
</pre></div>
</div>
<p>The OSVersion keyword is optional. It specifies the OS version you would like to use. It is only required if you have specified a %{OSVERSION}
variable in the <code class="docutils literal notranslate"><span class="pre">MirrorURL</span></code> keyword.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
</pre></div>
</div>
<p>The MirrorURL keyword is mandatory. It specifies the URL to use as a mirror to download the OS. If you define the <code class="docutils literal notranslate"><span class="pre">OSVersion</span></code> keyword, than you
can use it in the URL as in the example above.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Include: yum
</pre></div>
</div>
<p>The Include keyword is optional. It allows you to install additional packages into the core operating system. It is a best practice to supply
only the bare essentials such that the <code class="docutils literal notranslate"><span class="pre">%post</span></code> section has what it needs to properly complete the build. One common package you may want to install
when using the <code class="docutils literal notranslate"><span class="pre">yum</span></code> build module is YUM itself.</p>
</div>
<div class="section" id="id13">
<h3>Notes<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>There is a major limitation with using YUM to bootstrap a container. The RPM database that exists within the container will be created using the
RPM library and Berkeley DB implementation that exists on the host system. If the RPM implementation inside the container is not compatible with
the RPM database that was used to create the container, RPM and YUM commands inside the container may fail. This issue can be easily demonstrated
by bootstrapping an older RHEL compatible image by a newer one (e.g. bootstrap a Centos 5 or 6 container from a Centos 7 host).</p>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">debootstrap</span></code> build module, you must have <code class="docutils literal notranslate"><span class="pre">yum</span></code> installed on your system. It may seem counter-intuitive to install YUM on a system
that uses a different package manager, but you can do so. For instance, on Ubuntu you can install it like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update &amp;&amp; sudo apt-get install yum
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-debootstrap">
<span id="id14"></span><h2>build-debootstrap<a class="headerlink" href="#build-debootstrap" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-debootstrap">This module allows you to build a Debian/Ubuntu style container from a mirror URI.</p>
<div class="section" id="id15">
<h3>Overview<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">debootstrap</span></code> module to specify a base for a Debian-like container. You must also specify the OS version and a URI for the mirror you would like to use.</p>
</div>
<div class="section" id="id16">
<h3>Keywords<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: debootstrap
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>OSVersion: xenial
</pre></div>
</div>
<p>The OSVersion keyword is mandatory. It specifies the OS version you would like to use. For Ubuntu you can use code words like <code class="docutils literal notranslate"><span class="pre">trusty</span></code> (14.04), <code class="docutils literal notranslate"><span class="pre">xenial</span></code> (16.04),
and <code class="docutils literal notranslate"><span class="pre">yakkety</span></code> (17.04). For Debian you can use values like <code class="docutils literal notranslate"><span class="pre">stable</span></code>, <code class="docutils literal notranslate"><span class="pre">oldstable</span></code>, <code class="docutils literal notranslate"><span class="pre">testing</span></code>, and <code class="docutils literal notranslate"><span class="pre">unstable</span></code> or code words like <code class="docutils literal notranslate"><span class="pre">wheezy</span></code> (7), <code class="docutils literal notranslate"><span class="pre">jesse</span></code> (8), and <code class="docutils literal notranslate"><span class="pre">stretch</span></code> (9).</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MirrorURL:  http://us.archive.ubuntu.com/ubuntu/
</pre></div>
</div>
</div></blockquote>
<p>The MirrorURL keyword is mandatory. It specifies a URL to use as a mirror when downloading the OS.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Include: somepackage
</pre></div>
</div>
<p>The Include keyword is optional. It allows you to install additional packages into the core operating system. It is a best practice to supply only the bare essentials
such that the <code class="docutils literal notranslate"><span class="pre">%post</span></code> section has what it needs to properly complete the build.</p>
</div>
<div class="section" id="id17">
<h3>Notes<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">debootstrap</span></code> build module, you must have <code class="docutils literal notranslate"><span class="pre">debootstrap</span></code> installed on your system. On Ubuntu you can install it like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update &amp;&amp; sudo apt-get install debootstrap
</pre></div>
</div>
<p>On CentOS you can install it from the epel repos like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo yum update &amp;&amp; sudo yum install epel-release &amp;&amp; sudo yum install debootstrap.noarch
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-arch">
<span id="id18"></span><h2>build-arch<a class="headerlink" href="#build-arch" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-arch">This module allows you to build a Arch Linux based container.</p>
<div class="section" id="id19">
<h3>Overview<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">arch</span></code> module to specify a base for an Arch Linux based container. Arch Linux uses the aptly named the <code class="docutils literal notranslate"><span class="pre">pacman</span></code> package manager (all puns intended).</p>
</div>
<div class="section" id="id20">
<h3>Keywords<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: arch
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<p>The Arch Linux bootstrap module does not name any additional keywords at this time. By defining the <code class="docutils literal notranslate"><span class="pre">arch</span></code> module, you have essentially given all of the
information necessary for that particular bootstrap module to build a core operating system.</p>
</div>
<div class="section" id="id21">
<h3>Notes<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>Arch Linux is, by design, a very stripped down, light-weight OS. You may need to perform a fair amount of configuration to get a usable OS. Please refer
to this <a class="reference external" href="https://github.com/singularityware/singularity/blob/master/examples/arch/README.md">README.md</a> and
the <a class="reference external" href="https://github.com/singularityware/singularity/blob/master/examples/arch/Singularity">Arch Linux example</a> for more info.</p>
</div>
</div>
<div class="section" id="build-busybox">
<span id="id22"></span><h2>build-busybox<a class="headerlink" href="#build-busybox" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-busybox">This module allows you to build a container based on BusyBox.</p>
<div class="section" id="id23">
<h3>Overview<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">busybox</span></code> module to specify a BusyBox base for container. You must also specify a URI for the mirror you would like to use.</p>
</div>
<div class="section" id="id24">
<h3>Keywords<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: busybox
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>MirrorURL: https://www.busybox.net/downloads/binaries/1.26.1-defconfig-multiarch/busybox-x86_64
</pre></div>
</div>
<p>The MirrorURL keyword is mandatory. It specifies a URL to use as a mirror when downloading the OS.</p>
</div>
<div class="section" id="id25">
<h3>Notes<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>You can build a fully functional BusyBox container that only takes up ~600kB of disk space!</p>
</div>
</div>
<div class="section" id="build-zypper">
<span id="id26"></span><h2>build-zypper<a class="headerlink" href="#build-zypper" title="Permalink to this headline">¶</a></h2>
<p id="sec-build-zypper">This module allows you to build a Suse style container from a mirror URI.</p>
<div class="section" id="id27">
<h3>Overview<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">zypper</span></code> module to specify a base for a Suse-like container. You must also specify a URI for
the mirror you would like to use.</p>
</div>
<div class="section" id="id28">
<h3>Keywords<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: zypper
</pre></div>
</div>
<p>The Bootstrap keyword is always mandatory. It describes the bootstrap module to use.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>OSVersion: 42.2
</pre></div>
</div>
<p>The OSVersion keyword is optional. It specifies the OS version you would like to use.
It is only required if you have specified a %{OSVERSION} variable in the <code class="docutils literal notranslate"><span class="pre">MirrorURL</span></code> keyword.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Include: somepackage
</pre></div>
</div>
<p>The Include keyword is optional. It allows you to install additional packages into the core operating system.
It is a best practice to supply only the bare essentials such that the <code class="docutils literal notranslate"><span class="pre">%post</span></code> section has what it needs to properly complete the build.
One common package you may want to install when using the zypper build module is <code class="docutils literal notranslate"><span class="pre">zypper</span></code> itself.</p>
</div>
</div>
<div class="section" id="singularity-action-flags">
<span id="id29"></span><h2>Singularity Action Flags<a class="headerlink" href="#singularity-action-flags" title="Permalink to this headline">¶</a></h2>
<p id="sec-action-flags">For each of <code class="docutils literal notranslate"><span class="pre">exec</span></code>, <code class="docutils literal notranslate"><span class="pre">run</span></code>, and <code class="docutils literal notranslate"><span class="pre">shell</span></code>, there are a few important flags that we want to note for new users that have substantial impact on using
your container. While we won’t include the complete list of run options (for this complete list see <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">run</span> <span class="pre">--help</span></code> or more generally
<code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">&lt;action&gt;</span> <span class="pre">--help</span></code>) we will review some highly useful flags that you can add to these actions.</p>
<ul class="simple">
<li><strong>–contain</strong>: Contain suggests that we want to better isolate the container runtime from the host. Adding the <code class="docutils literal notranslate"><span class="pre">--contain</span></code> flag will use minimal</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">/dev</span></code> and empty other directories (e.g., <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>).</p>
<ul class="simple">
<li><strong>–containall</strong>: In addition to what is provided with <code class="docutils literal notranslate"><span class="pre">--contain</span></code> (filesystems) also contain PID, IPC, and environment.</li>
<li><strong>–cleanenv</strong>: Clean the environment before running the container.</li>
<li><strong>–pwd</strong>: Initial working directory for payload process inside the container.</li>
</ul>
<p>This is <strong>not</strong> a complete list! Please see the <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">&lt;action&gt;</span> <span class="pre">help</span></code> for an updated list.</p>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Here we are cleaning the environment. In the first command, we see that the variable <code class="docutils literal notranslate"><span class="pre">PEANUTBUTTER</span></code> gets passed into the container.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PEANUTBUTTER=JELLY singularity exec Centos7.img env | grep PEANUT

PEANUTBUTTER=JELLY
</pre></div>
</div>
<p>And now here we add <code class="docutils literal notranslate"><span class="pre">--cleanenv</span></code> to see that it doesn’t.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PEANUTBUTTER=JELLY singularity exec --cleanenv Centos7.img env | grep PEANUT
</pre></div>
</div>
<p>Here we will test contain. We can first confirm that there are a lot of files on our host in /tmp, and the same files are found in the container.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># On the host

$ ls /tmp | wc -l

17


# And then /tmp is mounted to the container, by default

$ singularity exec Centos7.img  ls /tmp | wc -l


# ..but not if we use --contain

$ singularity exec --contain Centos7.img  ls /tmp | wc -l

0
</pre></div>
</div>
</div>
</div>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-usage">
<span id="id30"></span><h3>Command Usage<a class="headerlink" href="#command-usage" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-singularity-command">
<span id="sec-commandlineinterface"></span><h4>The Singularity command<a class="headerlink" href="#the-singularity-command" title="Permalink to this headline">¶</a></h4>
<p>Singularity uses a primary command wrapper called <code class="docutils literal notranslate"><span class="pre">singularity</span></code>. When you run <code class="docutils literal notranslate"><span class="pre">singularity</span></code>
without any options or arguments it will dump the high level usage
syntax.</p>
<p>The general usage form is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity (opts1) [subcommand] (opts2) ...
</pre></div>
</div>
<p>If you type <code class="docutils literal notranslate"><span class="pre">singularity</span></code> without any arguments, you will see a high
level help for all arguments. The main options include:
<strong>Container Actions</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#build-command"><span class="std std-ref">build</span></a> : Build a container on your user endpoint or build environment</li>
<li><a class="reference internal" href="#exec-command"><span class="std std-ref">exec</span></a> : Execute a command to your container</li>
<li><a class="reference internal" href="#inspect-command"><span class="std std-ref">inspect</span></a> : See labels, run and test scripts, and environment variables</li>
<li><a class="reference internal" href="#pull-command"><span class="std std-ref">pull</span></a> : pull an image from Docker or Singularity Hub</li>
<li><a class="reference internal" href="#run-command"><span class="std std-ref">run</span></a> : Run your image as an executable</li>
<li><a class="reference internal" href="#shell-command"><span class="std std-ref">shell</span></a> : Shell into your image</li>
</ul>
<p><strong>Image Commands</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#image-import"><span class="std std-ref">image.import</span></a> : import layers or other file content to your image</li>
<li><a class="reference internal" href="#image-export"><span class="std std-ref">image.export</span></a> : export the contents of the image to tar or stream</li>
<li><a class="reference internal" href="#image-create"><span class="std std-ref">image.create</span></a> : create a new image, using the old ext3 filesystem</li>
<li><a class="reference internal" href="#image-expand"><span class="std std-ref">image.expand</span></a> : increase the size of your image (old ext3)</li>
</ul>
<p><strong>Instance Commands</strong></p>
<p>Instances were added in 2.4. This list is brief, and likely to expand
with further development.</p>
<ul class="simple">
<li><a class="reference internal" href="running_services.html#running-services"><span class="std std-ref">instances</span></a> : Start, stop, and list container instances</li>
</ul>
<p><strong>Deprecated Commands</strong>
The following commands are deprecated in 2.4 and will be removed in
future releases.</p>
<ul class="simple">
<li><a class="reference internal" href="#bootstrap"><span class="std std-ref">bootstrap</span></a> : Bootstrap a container recipe</li>
</ul>
<p>For the full usage, <a class="reference internal" href="#command-usage"><span class="std std-ref">see the bottom of this page</span></a></p>
<div class="section" id="options-and-argument-processing">
<h5>Options and argument processing<a class="headerlink" href="#options-and-argument-processing" title="Permalink to this headline">¶</a></h5>
<p>Because of the nature of how Singularity cascades commands and
sub-commands, argument processing is done with a mandatory order.
<strong>This means that where you place arguments is important!</strong> In the
above usage example, <code class="docutils literal notranslate"><span class="pre">opts1</span></code> are the global Singularity run-time options.
These options are always applicable no matter what subcommand you
select (e.g. <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> or <code class="docutils literal notranslate"><span class="pre">--debug</span></code> ). But subcommand specific options must be passed
after the relevant subcommand.</p>
<p>To further clarify this example, the <code class="docutils literal notranslate"><span class="pre">exec</span></code> Singularity subcommand will
execute a program within the container and pass the arguments passed
to the program. So to mitigate any argument clashes, Singularity must
not interpret or interfere with any of the command arguments or
options that are not relevant for that particular function.</p>
</div>
<div class="section" id="singularity-help">
<h5>Singularity Help<a class="headerlink" href="#singularity-help" title="Permalink to this headline">¶</a></h5>
<p>Singularity comes with some internal documentation by using the <code class="docutils literal notranslate"><span class="pre">help</span></code>
subcommand followed by the subcommand you want more information about.
For example:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity help create

CREATE OPTIONS:

    -s/--size   Specify a size for an operation in MiB, i.e. 1024*1024B

                (default 768MiB)

    -F/--force  Overwrite an image file if it exists


EXAMPLES:


    $ singularity create /tmp/Debian.img

    $ singularity create -s 4096 /tmp/Debian.img


For additional help, please visit our public documentation pages which are

found at:


    https://www.sylabs.io/docs/
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="commands-usage">
<h4>Commands Usage<a class="headerlink" href="#commands-usage" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-none notranslate" id="sec-commandsusage"><div class="highlight"><pre><span></span>USAGE: singularity [global options...] &lt;command&gt; [command options...] ...


GLOBAL OPTIONS:

    -d|--debug    Print debugging information

    -h|--help     Display usage summary

    -s|--silent   Only print errors

    -q|--quiet    Suppress all normal output

       --version  Show application version

    -v|--verbose  Increase verbosity +1

    -x|--sh-debug Print shell wrapper debugging information


GENERAL COMMANDS:

    help       Show additional help for a command or container

    selftest   Run some self tests for singularity install


CONTAINER USAGE COMMANDS:

    exec       Execute a command within container

    run        Launch a runscript within container

    shell      Run a Bourne shell within container

    test       Launch a testscript within container


CONTAINER MANAGEMENT COMMANDS:

    apps       List available apps within a container

    bootstrap  *Deprecated* use build instead

    build      Build a new Singularity container

    check      Perform container lint checks

    inspect    Display a container&#39;s metadata

    mount      Mount a Singularity container image

    pull       Pull a Singularity/Docker container to $PWD


COMMAND GROUPS:

    image      Container image command group

    instance   Persistent instance command group



CONTAINER USAGE OPTIONS:

    see singularity help &lt;command&gt;


For any additional help or support visit the Singularity

website: https://www.sylabs.io/contact/
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="support">
<h4>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h4>
<p>Have a question, or need further information? <a class="reference external" href="https://www.sylabs.io/contact/">Reach out to us</a>.</p>
</div>
</div>
<div class="section" id="build">
<span id="build-command"></span><h3>build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">build</span></code> to download and assemble existing containers, convert containers
from one format to another, or build a container from a <a class="reference internal" href="container_recipes.html#container-recipes"><span class="std std-ref">Singularity recipe</span></a>.</p>
<div class="section" id="id31">
<h4>Overview<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">build</span></code> command accepts a target as input and produces a container as
output. The target can be a Singularity Hub or Docker Hub URI, a path
to an existing container, or a path to a Singularity Recipe file. The
output container can be in squashfs, ext3, or directory format.</p>
<p>For a complete list of <code class="docutils literal notranslate"><span class="pre">build</span></code> options type <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">help</span> <span class="pre">build</span></code>. For more info on building
containers see <a class="reference internal" href="build_a_container.html#build-a-container"><span class="std std-ref">Build a Container</span></a>.</p>
</div>
<div class="section" id="id32">
<h4>Examples<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<div class="section" id="download-an-existing-container-from-singularity-hub-or-docker-hub">
<h5>Download an existing container from Singularity Hub or Docker Hub<a class="headerlink" href="#download-an-existing-container-from-singularity-hub-or-docker-hub" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity build lolcow.simg shub://GodloveD/lolcow

$ singularity build lolcow.simg docker://godlovedc/lolcow
</pre></div>
</div>
</div>
<div class="section" id="create-writable-images-and-sandbox-directories">
<h5>Create –writable images and –sandbox directories<a class="headerlink" href="#create-writable-images-and-sandbox-directories" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo singularity build --writable lolcow.img shub://GodloveD/lolcow

$ sudo singularity build --sandbox lolcow/ shub://GodloveD/lolcow
</pre></div>
</div>
</div>
<div class="section" id="convert-containers-from-one-format-to-another">
<h5>Convert containers from one format to another<a class="headerlink" href="#convert-containers-from-one-format-to-another" title="Permalink to this headline">¶</a></h5>
<p>You can convert the three supported container formats using any
combination.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo singularity build --writable development.img production.simg

$ singularity build --sandbox development/ production.simg

$ singularity build production2 development/
</pre></div>
</div>
</div>
<div class="section" id="build-a-container-from-a-singularity-recipe">
<h5>Build a container from a Singularity recipe<a class="headerlink" href="#build-a-container-from-a-singularity-recipe" title="Permalink to this headline">¶</a></h5>
<p>Given a Singularity Recipe called <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo singularity build lolcow.simg Singularity
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exec">
<span id="exec-command"></span><h3>exec<a class="headerlink" href="#exec" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">exec</span></code> Singularity sub-command allows you to spawn an arbitrary command
within your container image as if it were running directly on the host
system. All standard IO, pipes, and file systems are accessible via the
command being exec’ed within the container. Note that this exec is
different from the Docker exec, as it does not require a container to be
“running” before using it.</p>
<div class="section" id="id33">
<h4>Examples<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<div class="section" id="printing-the-os-release-inside-the-container">
<h5>Printing the OS release inside the container<a class="headerlink" href="#printing-the-os-release-inside-the-container" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec container.img cat /etc/os-release

PRETTY_NAME=&quot;Debian GNU/Linux 8 (jessie)&quot;

NAME=&quot;Debian GNU/Linux&quot;

VERSION_ID=&quot;8&quot;

VERSION=&quot;8 (jessie)&quot;

ID=debian

HOME_URL=&quot;http://www.debian.org/&quot;

SUPPORT_URL=&quot;http://www.debian.org/support&quot;

BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;

$
</pre></div>
</div>
</div>
<div class="section" id="printing-the-os-release-for-a-running-instance">
<h5>Printing the OS release for a running instance<a class="headerlink" href="#printing-the-os-release-for-a-running-instance" title="Permalink to this headline">¶</a></h5>
<p>Use the <code class="docutils literal notranslate"><span class="pre">instance://&lt;instance</span> <span class="pre">name&gt;</span></code> syntax like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec instance://my-instance cat /etc/os-release
</pre></div>
</div>
</div>
<div class="section" id="runtime-flags">
<h5>Runtime Flags<a class="headerlink" href="#runtime-flags" title="Permalink to this headline">¶</a></h5>
<p>If you are interested in containing an environment or filesystem
locations, we highly recommend that you look at the <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">run</span> <span class="pre">help</span></code> and our
documentation on <a class="reference internal" href="#singularity-action-flags"><span class="std std-ref">flags</span></a> to better customize this command.</p>
</div>
<div class="section" id="special-characters">
<h5>Special Characters<a class="headerlink" href="#special-characters" title="Permalink to this headline">¶</a></h5>
<p>And properly passing along special characters to the program within the
container.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec container.img echo -ne &quot;hello\nworld\n\n&quot;

hello

world

$
</pre></div>
</div>
<p>And a demonstration using pipes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat debian.def | singularity exec container.img grep &#39;MirrorURL&#39;

MirrorURL &quot;http://ftp.us.debian.org/debian/&quot;

$
</pre></div>
</div>
</div>
<div class="section" id="a-python-example">
<h5>A Python example<a class="headerlink" href="#a-python-example" title="Permalink to this headline">¶</a></h5>
<p>Starting with the file <code class="docutils literal notranslate"><span class="pre">hello.py</span></code> in the current directory with the contents of:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/python


import sys

print(&quot;Hello World: The Python version is %s.%s.%s&quot; % sys.version_info[:3])
</pre></div>
</div>
<p>Because our home directory is automatically bound into the container,
and we are running this from our home directory, we can easily execute
that script using the Python within the container:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec /tmp/Centos7-ompi.img /usr/bin/python hello.py

Hello World: The Python version is 2.7.5
</pre></div>
</div>
<p>We can also pipe that script through the container and into the Python
binary which exists inside the container using the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat hello.py | singularity exec /tmp/Centos7-ompi.img /usr/bin/python

Hello World: The Python version is 2.7.5
</pre></div>
</div>
<p>For demonstration purposes, let’s also try to use the latest Python
container which exists in DockerHub to run this script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec docker://python:latest /usr/local/bin/python hello.py

library/python:latest

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:fbd06356349dd9fb6af91f98c398c0c5d05730a9996bbf88ff2f2067d59c70c4

Downloading layer: sha256:644eaeceac9ff6195008c1e20dd693346c35b0b65b9a90b3bcba18ea4bcef071

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:766692404ca72f4e31e248eb82f8eca6b2fcc15b22930ec50e3804cc3efe0aba

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:6a3d69edbe90ef916e1ecd8d197f056de873ed08bcfd55a1cd0b43588f3dbb9a

Downloading layer: sha256:ff18e19c2db42055e6f34323700737bde3c819b413997cddace2c1b7180d7efd

Downloading layer: sha256:7b9457ec39de00bc70af1c9631b9ae6ede5a3ab715e6492c0a2641868ec1deda

Downloading layer: sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

Downloading layer: sha256:6a5a5368e0c2d3e5909184fa28ddfd56072e7ff3ee9a945876f7eee5896ef5bb

Hello World: The Python version is 3.5.2
</pre></div>
</div>
</div>
<div class="section" id="a-gpu-example">
<h5>A GPU example<a class="headerlink" href="#a-gpu-example" title="Permalink to this headline">¶</a></h5>
<p>If your host system has an NVIDIA GPU card and a driver installed you
can leverage the card with the <code class="docutils literal notranslate"><span class="pre">--nv</span></code> option. (This example requires a fairly
recent version of the NVIDIA driver on the host system to run the latest
version of TensorFlow.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/tensorflow/models.git

$ singularity exec --nv docker://tensorflow/tensorflow:latest-gpu \

    python ./models/tutorials/image/mnist/convolutional.py

Docker image path: index.docker.io/tensorflow/tensorflow:latest-gpu

Cache folder set to /home/david/.singularity/docker

[19/19] |===================================| 100.0%

Creating container runtime...

Extracting data/train-images-idx3-ubyte.gz

Extracting data/train-labels-idx1-ubyte.gz

Extracting data/t10k-images-idx3-ubyte.gz

Extracting data/t10k-labels-idx1-ubyte.gz

2017-08-18 20:33:59.677580: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn&#39;t compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.

2017-08-18 20:33:59.677620: W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn&#39;t compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.

2017-08-18 20:34:00.148531: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:893] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero

2017-08-18 20:34:00.148926: I tensorflow/core/common_runtime/gpu/gpu_device.cc:955] Found device 0 with properties:

name: GeForce GTX 760 (192-bit)

major: 3 minor: 0 memoryClockRate (GHz) 0.8885

pciBusID 0000:03:00.0

Total memory: 2.95GiB

Free memory: 2.92GiB

2017-08-18 20:34:00.148954: I tensorflow/core/common_runtime/gpu/gpu_device.cc:976] DMA: 0

2017-08-18 20:34:00.148965: I tensorflow/core/common_runtime/gpu/gpu_device.cc:986] 0:   Y

2017-08-18 20:34:00.148979: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1045] Creating TensorFlow device (/gpu:0) -&gt; (device: 0, name: GeForce GTX 760 (192-bit), pci bus id: 0000:03:00.0)

Initialized!

Step 0 (epoch 0.00), 21.7 ms

Minibatch loss: 8.334, learning rate: 0.010000

Minibatch error: 85.9%

Validation error: 84.6%

Step 100 (epoch 0.12), 20.9 ms

Minibatch loss: 3.235, learning rate: 0.010000

Minibatch error: 4.7%

Validation error: 7.8%

Step 200 (epoch 0.23), 20.5 ms

Minibatch loss: 3.363, learning rate: 0.010000

Minibatch error: 9.4%

Validation error: 4.2%

[...snip...]

Step 8500 (epoch 9.89), 20.5 ms

Minibatch loss: 1.602, learning rate: 0.006302

Minibatch error: 0.0%

Validation error: 0.9%

Test error: 0.8%
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="inspect">
<span id="inspect-command"></span><h3>inspect<a class="headerlink" href="#inspect" title="Permalink to this headline">¶</a></h3>
<p>How can you sniff an image? We have provided the inspect command for
you to easily see the runscript, test script, environment, help, and
metadata labels.</p>
<p>This command is essential for making containers understandable by
other tools and applications.</p>
<div class="section" id="json-api-standard">
<h4>JSON Api Standard<a class="headerlink" href="#json-api-standard" title="Permalink to this headline">¶</a></h4>
<p>For any inspect command, by adding <code class="docutils literal notranslate"><span class="pre">--json</span></code> you can be assured to get a
JSON API standardized response, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity inspect -l --json ubuntu.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;labels&quot;: {

                &quot;SINGULARITY_DEFFILE_BOOTSTRAP&quot;: &quot;docker&quot;,

                &quot;SINGULARITY_DEFFILE&quot;: &quot;Singularity&quot;,

                &quot;SINGULARITY_BOOTSTRAP_VERSION&quot;: &quot;2.2.99&quot;,

                &quot;SINGULARITY_DEFFILE_FROM&quot;: &quot;ubuntu:latest&quot;

            }

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
</div>
<div class="section" id="inspect-flags">
<h4>Inspect Flags<a class="headerlink" href="#inspect-flags" title="Permalink to this headline">¶</a></h4>
<p>The default, if run without any arguments, will show you the container
labels file</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect ubuntu.img

{

    &quot;SINGULARITY_DEFFILE_BOOTSTRAP&quot;: &quot;docker&quot;,

    &quot;SINGULARITY_DEFFILE&quot;: &quot;Singularity&quot;,

    &quot;SINGULARITY_BOOTSTRAP_VERSION&quot;: &quot;2.2.99&quot;,

    &quot;SINGULARITY_DEFFILE_FROM&quot;: &quot;ubuntu:latest&quot;

}
</pre></div>
</div>
<p>and as outlined in the usage, you can specify to see any combination of <code class="docutils literal notranslate"><span class="pre">--labels</span></code>
, <code class="docutils literal notranslate"><span class="pre">--environment</span></code> , <code class="docutils literal notranslate"><span class="pre">--runscript</span></code> , <code class="docutils literal notranslate"><span class="pre">--test</span></code> , and <code class="docutils literal notranslate"><span class="pre">--deffile</span></code>. The quick command to see everything, in json format, would
be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -l -r -d -t -e -j -hf ubuntu.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;test&quot;: null,

            &quot;help&quot;: &quot;This is how you run the image!\n&quot;,

            &quot;environment&quot;: &quot;# Custom environment shell code should follow\n\n&quot;,

            &quot;labels&quot;: {

                &quot;SINGULARITY_DEFFILE_BOOTSTRAP&quot;: &quot;docker&quot;,

                &quot;SINGULARITY_DEFFILE&quot;: &quot;Singularity&quot;,

                &quot;SINGULARITY_BOOTSTRAP_VERSION&quot;: &quot;2.2.99&quot;,

                &quot;SINGULARITY_DEFFILE_FROM&quot;: &quot;ubuntu:latest&quot;

            },

            &quot;deffile&quot;: &quot;Bootstrap:docker\nFrom:ubuntu:latest\n&quot;,

            &quot;runscript&quot;: &quot;#!/bin/sh\n\nexec /bin/bash \&quot;$@\&quot;&quot;

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
<div class="section" id="labels">
<h5>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h5>
<p>The default, if run without any arguments, will show you the container
labels file (located at <code class="docutils literal notranslate"><span class="pre">/.singularity.d/labels.json</span></code> in the container. These labels are the ones that
you define in the <code class="docutils literal notranslate"><span class="pre">%labels</span></code> section of your bootstrap file, along with any Docker <code class="docutils literal notranslate"><span class="pre">LABEL</span></code>
that came with an image that you imported, and other metadata about the
bootstrap. For example, here we are inspecting labels for <code class="docutils literal notranslate"><span class="pre">ubuntu.img</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect ubuntu.img

{

    &quot;SINGULARITY_DEFFILE_BOOTSTRAP&quot;: &quot;docker&quot;,

    &quot;SINGULARITY_DEFFILE&quot;: &quot;Singularity&quot;,

    &quot;SINGULARITY_BOOTSTRAP_VERSION&quot;: &quot;2.2.99&quot;,

    &quot;SINGULARITY_DEFFILE_FROM&quot;: &quot;ubuntu:latest&quot;

}
</pre></div>
</div>
<p>This is the equivalent of both of:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -l ubuntu.img

$ singularity inspect --labels ubuntu.img
</pre></div>
</div>
</div>
<div class="section" id="runscript">
<h5>Runscript<a class="headerlink" href="#runscript" title="Permalink to this headline">¶</a></h5>
<p>The commands <code class="docutils literal notranslate"><span class="pre">--runscript</span></code> or <code class="docutils literal notranslate"><span class="pre">--r</span></code> will show you the runscript, which also can be shown in <code class="docutils literal notranslate"><span class="pre">--json</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -r -j ubuntu.img{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;runscript&quot;: &quot;#!/bin/sh\n\nexec /bin/bash \&quot;$@\&quot;&quot;

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
<p>or in a human friendly, readable print to the screen:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -r ubuntu.img


##runscript

#!/bin/sh


exec /bin/bash &quot;$@&quot;
</pre></div>
</div>
</div>
<div class="section" id="help">
<h5>Help<a class="headerlink" href="#help" title="Permalink to this headline">¶</a></h5>
<p>The commands <code class="docutils literal notranslate"><span class="pre">--helpfile</span></code> or <code class="docutils literal notranslate"><span class="pre">--hf</span></code> will show you the runscript helpfile, if it exists.
With <code class="docutils literal notranslate"><span class="pre">--json</span></code> you can also see it as such:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity inspect -hf -j dino.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;help&quot;: &quot;\n\n\nHi there! This is my image help section.\n\nUsage:\n\nboobeep doo doo\n\n --arg/a arrrrg I&#39;m a pirate!\n --boo/b eeeeeuzzz where is the honey?\n\n\n&quot;

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
<p>or in a human friendly, readable print to the screen, don’t use <code class="docutils literal notranslate"><span class="pre">-j</span></code> or <code class="docutils literal notranslate"><span class="pre">--json</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -hf dino.img



Hi there! This is my image help section.


Usage:


boobeep doo doo


 --arg/a arrrrg I&#39;m a pirate!

 --boo/b eeeeeuzzz where is the honey?
</pre></div>
</div>
</div>
<div class="section" id="environment">
<h5>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h5>
<p>The commands <code class="docutils literal notranslate"><span class="pre">--environment</span></code> and <code class="docutils literal notranslate"><span class="pre">-e</span></code> will show you the container’s environment, again
specified by the <code class="docutils literal notranslate"><span class="pre">%environment</span></code> section of a bootstrap file, and other ENV labels that
might have come from a Docker import. You can again choose to see <code class="docutils literal notranslate"><span class="pre">--json</span></code> :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -e --json ubuntu.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;environment&quot;: &quot;# Custom environment shell code should follow\n\n&quot;

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
<p>or human friendly:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -e ubuntu.img


##environment

# Custom environment shell code should follow
</pre></div>
</div>
<p>The container in the example above did not have any custom environment</p>
<p>variables set.</p>
</div>
<div class="section" id="test">
<h5>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h5>
<p>The equivalent <code class="docutils literal notranslate"><span class="pre">--test</span></code> or <code class="docutils literal notranslate"><span class="pre">-t</span></code> commands will print any test defined for the
container, which comes from the  <code class="docutils literal notranslate"><span class="pre">%test</span></code> section of the bootstrap specification
Singularity file. Again, we can ask for <code class="docutils literal notranslate"><span class="pre">--json</span></code> or human friendly (default):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity --inspect -t --json ubuntu.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;test&quot;: null

        },

        &quot;type&quot;: &quot;container&quot;

    }

}


$ singularity inspect -t  ubuntu.img

{

    &quot;status&quot;: 404,

    &quot;detail&quot;: &quot;This container does not have any tests defined&quot;,

    &quot;title&quot;: &quot;Tests Undefined&quot;

}
</pre></div>
</div>
</div>
<div class="section" id="deffile">
<h5>Deffile<a class="headerlink" href="#deffile" title="Permalink to this headline">¶</a></h5>
<p>Want to know where your container came from? You can see the entire
Singularity definition file, if the container was created with a
bootstrap, by using <code class="docutils literal notranslate"><span class="pre">--deffile</span></code> or <code class="docutils literal notranslate"><span class="pre">-d</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -d  ubuntu.img


##deffile

Bootstrap:docker

From:ubuntu:latest
</pre></div>
</div>
<p>or with <code class="docutils literal notranslate"><span class="pre">--json</span></code> output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity inspect -d --json ubuntu.img

{

    &quot;data&quot;: {

        &quot;attributes&quot;: {

            &quot;deffile&quot;: &quot;Bootstrap:docker\nFrom:ubuntu:latest\n&quot;

        },

        &quot;type&quot;: &quot;container&quot;

    }

}
</pre></div>
</div>
<p>The goal of these commands is to bring more transparency to containers,
and to help better integrate them into common workflows by having them
expose their guts to the world! If you have feedback for how we can
improve or amend this, <a class="reference external" href="https://github.com/singularityware/singularity/issues">please let us know</a>!</p>
</div>
</div>
</div>
<div class="section" id="pull">
<span id="pull-command"></span><h3>pull<a class="headerlink" href="#pull" title="Permalink to this headline">¶</a></h3>
<p id="sec-pull">Singularity <code class="docutils literal notranslate"><span class="pre">pull</span></code> is the command that you would want to use to communicate
with a container registry. The command does exactly as it says - there
exists an image external to my host, and I want to pull it here. We
currently support pull for both <a class="reference external" href="https://hub.docker.com/">Docker</a> and <a class="reference external" href="https://singularity-hub.org/">Singularity Hub
images</a>, and will review usage for both.</p>
<div class="section" id="singularity-hub">
<h4>Singularity Hub<a class="headerlink" href="#singularity-hub" title="Permalink to this headline">¶</a></h4>
<p>Singularity differs from Docker in that we serve entire images, as
opposed to layers. This means that pulling a Singularity Hub means
downloading the entire (compressed) container file, and then having it
extract on your local machine. The basic command is the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull shub://vsoch/hello-world

Progress |===================================| 100.0%

Done. Container is at: ./vsoch-hello-world-master.img
</pre></div>
</div>
<div class="section" id="how-do-tags-work">
<h5>How do tags work?<a class="headerlink" href="#how-do-tags-work" title="Permalink to this headline">¶</a></h5>
<p>On Singularity Hub, a <code class="docutils literal notranslate"><span class="pre">tag</span></code> coincide with a branch. So if you have a repo
called <code class="docutils literal notranslate"><span class="pre">vsoch/hello-world</span></code> , by default the file called <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> (your build recipe file) will be
looked for in the base of the master branch. The command that we issued
above would be equivalent to doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull shub://vsoch/hello-world:master
</pre></div>
</div>
<p>To enable other branches to build, they must be turned on in your
collection. If you then put another Singularity file in a branch called development,
you would pull it as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull shub://vsoch/hello-world:development
</pre></div>
</div>
<p>The term <code class="docutils literal notranslate"><span class="pre">latest</span></code> in Singularity Hub will pull, across all of your
branches, the most recent image. If <code class="docutils literal notranslate"><span class="pre">development</span></code> is more recent than
<code class="docutils literal notranslate"><span class="pre">master</span></code>, it would be pulled, for example.</p>
</div>
<div class="section" id="image-names">
<h5>Image Names<a class="headerlink" href="#image-names" title="Permalink to this headline">¶</a></h5>
<p>As you can see, since we didn’t specify anything special, the default
naming convention is to use the username, reponame, and the branch
(tag). You have three options for changing this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PULL OPTIONS:

    -n/--name   Specify a custom container name (first priority)

    -C/--commit Name container based on GitHub commit (second priority)

    -H/--hash   Name container based on file hash (second priority)
</pre></div>
</div>
</div>
<div class="section" id="custom-name">
<h5>Custom Name<a class="headerlink" href="#custom-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull --name meatballs.img shub://vsoch/hello-world

Progress |===================================| 100.0%

Done. Container is at: ./meatballs.img
</pre></div>
</div>
</div>
<div class="section" id="name-by-commit">
<h5>Name by commit<a class="headerlink" href="#name-by-commit" title="Permalink to this headline">¶</a></h5>
<p>Each container build on Singularity Hub is associated with the GitHub
commit of the repo that was used to build it. You can specify to name
your container based on the commit with the <code class="docutils literal notranslate"><span class="pre">--commit</span></code> flag, if, for example, you
want to match containers to their build files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull --commit shub://vsoch/hello-world

Progress |===================================| 100.0%

Done. Container is at: ./4187993b8b44cbfa51c7e38e6b527918fcdf0470.img
</pre></div>
</div>
</div>
<div class="section" id="name-by-hash">
<h5>Name by hash<a class="headerlink" href="#name-by-hash" title="Permalink to this headline">¶</a></h5>
<p>If you prefer the hash of the file itself, you can do that too.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull --hash shub://vsoch/hello-world

Progress |===================================| 100.0%

Done. Container is at: ./4db5b0723cfd378e332fa4806dd79e31.img
</pre></div>
</div>
</div>
<div class="section" id="pull-to-different-folder">
<h5>Pull to different folder<a class="headerlink" href="#pull-to-different-folder" title="Permalink to this headline">¶</a></h5>
<p>For any of the above, if you want to specify a different folder for
your image, you can define the variable <code class="docutils literal notranslate"><span class="pre">SINGULARITY_PULLFOLDER</span></code>. By default, we will first
check if you have the <code class="docutils literal notranslate"><span class="pre">SINGULARITY_CACHEDIR</span></code> defined, and pull images there. If not, we look
for <code class="docutils literal notranslate"><span class="pre">SINGULARITY_PULLFOLDER</span></code>. If neither of these are defined, the image is pulled to the
present working directory, as we showed above. Here is an example of
pulling to <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> .</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SINGULARITY_PULLFOLDER=/tmp

singularity pull shub://vsoch/hello-world

Progress |===================================| 100.0%

Done. Container is at: /tmp/vsoch-hello-world-master.img
</pre></div>
</div>
</div>
<div class="section" id="pull-by-commit">
<h5>Pull by commit<a class="headerlink" href="#pull-by-commit" title="Permalink to this headline">¶</a></h5>
<p>You can also pull different versions of your container by using their
commit id ( <code class="docutils literal notranslate"><span class="pre">version</span></code> ).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull shub://vsoch/hello-world@42e1f04ed80217895f8c960bdde6bef4d34fab59

Progress |===================================| 100.0%

Done. Container is at: ./vsoch-hello-world-master.img
</pre></div>
</div>
<p>In this example, the first build of this container will be pulled.</p>
</div>
</div>
<div class="section" id="id34">
<h4>Docker<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>Docker pull is similar (on the surface) to a Singularity Hub pull, and
we would do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull docker://ubuntu

Initializing Singularity image subsystem

Opening image file: ubuntu.img

Creating 223MiB image

Binding image to loop

Creating file system within image

Image is done: ubuntu.img

Docker image path: index.docker.io/library/ubuntu:latest

Cache folder set to /home/vanessa/.singularity/docker

Importing: base Singularity environment

Importing: /home/vanessa/.singularity/docker/sha256:b6f892c0043b37bd1834a4a1b7d68fe6421c6acbc7e7e63a4527e1d379f92c1b.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:55010f332b047687e081a9639fac04918552c144bc2da4edb3422ce8efcc1fb1.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:2955fb827c947b782af190a759805d229cfebc75978dba2d01b4a59e6a333845.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:3deef3fcbd3072b45771bd0d192d4e5ff2b7310b99ea92bce062e01097953505.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:cf9722e506aada1109f5c00a9ba542a81c9e109606c01c81f5991b1f93de7b66.tar.gz

Importing: /home/vanessa/.singularity/metadata/sha256:fe44851d529f465f9aa107b32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz

Done. Container is at: ubuntu.img
</pre></div>
</div>
<p>If you specify the tag, the image would be named accordingly (eg, <code class="docutils literal notranslate"><span class="pre">ubuntu-latest.img</span></code>). Did
you notice that the output looks similar to if we did the following?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity create ubuntu.img

singularity import ubuntu.img docker://ubuntu
</pre></div>
</div>
<p>this is because the same logic is happening on the back end. Thus, the
pull command with a docker uri also supports arguments <code class="docutils literal notranslate"><span class="pre">--size</span></code> and <code class="docutils literal notranslate"><span class="pre">--name</span></code> . Here is how I
would pull an ubuntu image, but make it bigger, and name it something
else.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity pull --size 2000 --name jellybelly.img docker://ubuntu

Initializing Singularity image subsystem

Opening image file: jellybelly.img

Creating 2000MiB image

Binding image to loop

Creating file system within image

Image is done: jellybelly.img

Docker image path: index.docker.io/library/ubuntu:latest

Cache folder set to /home/vanessa/.singularity/docker

Importing: base Singularity environment

Importing: /home/vanessa/.singularity/docker/sha256:b6f892c0043b37bd1834a4a1b7d68fe6421c6acbc7e7e63a4527e1d379f92c1b.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:55010f332b047687e081a9639fac04918552c144bc2da4edb3422ce8efcc1fb1.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:2955fb827c947b782af190a759805d229cfebc75978dba2d01b4a59e6a333845.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:3deef3fcbd3072b45771bd0d192d4e5ff2b7310b99ea92bce062e01097953505.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:cf9722e506aada1109f5c00a9ba542a81c9e109606c01c81f5991b1f93de7b66.tar.gz

Importing: /home/vanessa/.singularity/metadata/sha256:fe44851d529f465f9aa107b32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz

Done. Container is at: jellybelly.img
</pre></div>
</div>
</div>
</div>
<div class="section" id="run">
<span id="run-command"></span><h3>run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h3>
<p>It’s common to want your container to “do a thing.” Singularity <code class="docutils literal notranslate"><span class="pre">run</span></code> allows
you to define a custom action to be taken when a container is either <code class="docutils literal notranslate"><span class="pre">run</span></code> or
executed directly by file name. Specifically, you might want it to
execute a command, or run an executable that gives access to many
different functions for the user.</p>
<div class="section" id="id35">
<h4>Overview<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>First, how do we run a container? We can do that in one of two ways -
the commands below are identical:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity run centos7.img

$ ./centos7.img
</pre></div>
</div>
<p>In both cases, we are executing the container’s “runscript” (the
executable <code class="docutils literal notranslate"><span class="pre">/singularity</span></code> at the root of the image) that is either an actual file
(version 2.2 and earlier) or a link to one (2.3 and later). For example,
looking at a 2.3 image, I can see the runscript via the path to the
link:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec centos7.img cat /singularity

#!/bin/sh


exec /bin/bash &quot;$@&quot;
</pre></div>
</div>
<p>or to the actual file in the container’s metadata folder, <code class="docutils literal notranslate"><span class="pre">/.singularity.d</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec centos7.img cat /.singularity.d/runscript

#!/bin/sh


exec /bin/bash &quot;$@&quot;
</pre></div>
</div>
<p>Notice how the runscript has bash followed by <code class="docutils literal notranslate"><span class="pre">\$&#64;</span></code> ? This is good practice
to include in a runscript, as any arguments passed by the user will be
given to the container.</p>
</div>
<div class="section" id="id36">
<h4>Runtime Flags<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<p>If you are interested in containing an environment or filesystem
locations, we highly recommend that you look at the <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">run</span> <span class="pre">help</span></code> and our
documentation on <a class="reference internal" href="#singularity-action-flags"><span class="std std-ref">flags</span></a>
to better customize this command.</p>
</div>
<div class="section" id="id37">
<h4>Examples<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<p>In this example the container has a very simple runscript defined.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec centos7.img cat /singularity

#!/bin/sh


echo motorbot


$ singularity run centos7.img

motorbot
</pre></div>
</div>
<div class="section" id="defining-the-runscript">
<h5>Defining the Runscript<a class="headerlink" href="#defining-the-runscript" title="Permalink to this headline">¶</a></h5>
<p>When you first create a container, the runscript is defined using the
following order of operations:</p>
<ol class="arabic simple">
<li>A user defined runscript in the <code class="docutils literal notranslate"><span class="pre">%runscript</span></code> section of a bootstrap takes
preference over all</li>
<li>If the user has not defined a runscript and is importing a Docker
container, the Docker <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> is used.</li>
<li>If a user has not defined a runscript and adds <code class="docutils literal notranslate"><span class="pre">IncludeCmd:</span> <span class="pre">yes</span></code> to the bootstrap file,
the <code class="docutils literal notranslate"><span class="pre">CMD</span></code> is used over the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code></li>
<li>If the user has not defined a runscript and the Docker container</li>
</ol>
<blockquote>
<div>doesn’t have an <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code>, we look for <code class="docutils literal notranslate"><span class="pre">CMD</span></code>, even if the user hasn’t asked for it.</div></blockquote>
<ol class="arabic simple">
<li>If the user has not defined a runscript, and there is no <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> or <code class="docutils literal notranslate"><span class="pre">CMD</span></code> (or we
aren’t importing Docker at all) then we default to <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code></li>
</ol>
<p>Here is how you would define the runscript section when you <a class="reference internal" href="build_a_container.html#build-a-container"><span class="std std-ref">build</span></a> an image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: docker

From: ubuntu:latest


%runscript

exec /usr/bin/python &quot;$@&quot;
</pre></div>
</div>
<p>and of course python should be installed as /usr/bin/python. The
addition of <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> ensures that arguments are passed along from the user. If
you want your container to run absolutely any command given to it, and
you want to use run instead of exec, you could also just do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap: docker

From: ubuntu:latest


%runscript

exec &quot;$@&quot;`
</pre></div>
</div>
<p>If you want different entrypoints for your image, we recommend using the
%apprun syntax (see <span class="xref std std-ref">apps</span>). Here we have two entrypoints for foo and bar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%runscript

exec echo &quot;Try running with --app dog/cat&quot;


%apprun dog

exec echo Hello &quot;$@&quot;, this is Dog


%apprun cat

exec echo Meow &quot;$@&quot;, this is Cat
</pre></div>
</div>
<p>and then running (after build of a complete recipe) would look like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo singularity build catdog.simg Singularity


$ singularity run catdog.simg

Try running with --app dog/cat


$ singularity run --app cat catdog.simg

Meow , this is Cat

$ singularity run --app dog catdog.simg

Hello , this is Dog
</pre></div>
</div>
<p>Generally, it is advised to provide help for your container with <code class="docutils literal notranslate"><span class="pre">%help</span></code> or <code class="docutils literal notranslate"><span class="pre">%apphelp</span></code>. If
you find it easier, you can also provide help by way of a runscript that
tells your user how to use the container, and gives access to the
important executables. Regardless of your strategy. a reproducible
container is one that tells the user how to interact with it.</p>
</div>
</div>
</div>
<div class="section" id="shell">
<span id="shell-command"></span><h3>shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">shell</span></code> Singularity sub-command will automatically spawn an interactive
shell within a container. As of v2.3 the default that is spawned via the
shell command is <code class="docutils literal notranslate"><span class="pre">/bin/bash</span></code> if it exists otherwise <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> is called.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell

USAGE: singularity (options) shell [container image] (options)
</pre></div>
</div>
<p>Here we can see the default shell in action:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell centos7.img

Singularity: Invoking an interactive shell within container...


Singularity centos7.img:~&gt; echo $SHELL

/bin/bash
</pre></div>
</div>
<p>Additionally any arguments passed to the Singularity command (after the
container name) will be passed to the called shell within the container,
and shell can be used across image types. Here is a quick example of
shelling into a container assembled from Docker layers. We highly
recommend that you look at the <code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">shell</span> <span class="pre">help</span></code> and our documentation on <a class="reference internal" href="#singularity-action-flags"><span class="std std-ref">flags</span></a> to
better customize this command.</p>
<div class="section" id="change-your-shell">
<h4>Change your shell<a class="headerlink" href="#change-your-shell" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">shell</span></code> sub-command allows you to set or change the default shell using the <code class="docutils literal notranslate"><span class="pre">--shell</span></code>
argument. As of Singularity version 2.2, you can also use the
environment variable <code class="docutils literal notranslate"><span class="pre">SINGULARITY_SHELL</span></code> which will use that as your shell entry point into
the container.</p>
<div class="section" id="bash">
<h5>Bash<a class="headerlink" href="#bash" title="Permalink to this headline">¶</a></h5>
<p>The correct way to do it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>export SINGULARITY_SHELL=&quot;/bin/bash --norc&quot;

singularity shell centos7.img Singularity: Invoking an interactive shell within container...

Singularity centos7.img:~/Desktop&gt; echo $SHELL

/bin/bash --norc
</pre></div>
</div>
<p>Don’t do this, it can be confusing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ export SINGULARITY_SHELL=/bin/bash

$ singularity shell centos7.img

Singularity: Invoking an interactive shell within container...


# What? We are still on my Desktop? Actually no, but the uri says we are!

vanessa@vanessa-ThinkPad-T460s:~/Desktop$ echo $SHELL

/bin/bash
</pre></div>
</div>
<p>Depending on your shell, you might also want the <code class="docutils literal notranslate"><span class="pre">--noprofile</span></code> flag. How can you learn
more about a shell? Ask it for help, of course!</p>
</div>
</div>
<div class="section" id="shell-help">
<h4>Shell Help<a class="headerlink" href="#shell-help" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell centos7.img --help

Singularity: Invoking an interactive shell within container...


GNU bash, version 4.2.46(1)-release-(x86_64-redhat-linux-gnu)

Usage:  /bin/bash [GNU long option] [option] ...

    /bin/bash [GNU long option] [option] script-file ...

GNU long options:

    --debug

    --debugger

    --dump-po-strings

    --dump-strings

    --help

    --init-file

    --login

    --noediting

    --noprofile

    --norc

    --posix

    --protected

    --rcfile

    --rpm-requires

    --restricted

    --verbose

    --version

Shell options:

    -irsD or -c command or -O shopt_option      (invocation only)

    -abefhkmnptuvxBCHP or -o option

Type `/bin/bash -c &quot;help set&quot;&#39; for more information about shell options.

Type `/bin/bash -c help&#39; for more information about shell builtin commands.
</pre></div>
</div>
<p>And thus we should be able to do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell centos7.img -c &quot;echo hello world&quot;

Singularity: Invoking an interactive shell within container...


hello world
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="image-command-group">
<h2>Image Command Group<a class="headerlink" href="#image-command-group" title="Permalink to this headline">¶</a></h2>
<div class="section" id="image-export">
<span id="id38"></span><h3>image.export<a class="headerlink" href="#image-export" title="Permalink to this headline">¶</a></h3>
<p id="sec-imageexport">Export is a way to dump the contents of your container into a <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code>, or a
stream to put into some other place. For example, you could stream
this into an in memory tar in python. Importantly, this command was
originally intended for Singularity version less than 2.4 in the case
of exporting an ext3 filesystem. For Singularity greater than 2.4, the
resulting export file is likely to be larger than the original
squashfs counterpart. An example with an ext3 image is provided.</p>
<p>Here we export an image into a <code class="docutils literal notranslate"><span class="pre">.tar</span></code> file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity image.export container.img &gt; container.tar
</pre></div>
</div>
<p>We can also specify the file with <code class="docutils literal notranslate"><span class="pre">--file</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity image.export --file container.tar container.img
</pre></div>
</div>
<p>And here is the recommended way to compress your image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity image.export container.img | gzip -9 &gt; container.img.tar.gz
</pre></div>
</div>
</div>
<div class="section" id="image-expand">
<span id="id39"></span><h3>image.expand<a class="headerlink" href="#image-expand" title="Permalink to this headline">¶</a></h3>
<p id="sec-imageexpand">While the squashfs filesystem means that you typically don’t need to
worry about the size of your container being built, you might find that
if you are building an ext3 image (pre Singularity 2.4) you want to
expand it.</p>
<div class="section" id="increasing-the-size-of-an-existing-image">
<h4>Increasing the size of an existing image<a class="headerlink" href="#increasing-the-size-of-an-existing-image" title="Permalink to this headline">¶</a></h4>
<p>You can increase the size of an image after it has been instantiated
by using the image.expand Singularity sub-command. In the example
below, we:</p>
<ol class="arabic simple">
<li>create an empty image</li>
<li>inspect it’s size</li>
<li>expand it</li>
<li>confirm it’s larger</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity image.create container.img

Creating empty 768MiB image file: container.imglarity image.create container.im

Formatting image with ext3 file system

Image is done: container.img


$ ls -lh container.img

-rw-rw-r-- 1 vanessa vanessa 768M Oct  2 18:48 container.img


$ singularity image.expand container.img

Expanding image by 768MB

Checking image&#39;s file system

e2fsck 1.42.13 (17-May-2015)

Pass 1: Checking inodes, blocks, and sizes

Pass 2: Checking directory structure

Pass 3: Checking directory connectivity

Pass 4: Checking reference counts

Pass 5: Checking group summary information

container.img: 11/49152 files (0.0% non-contiguous), 7387/196608 blocks

Resizing image&#39;s file system

resize2fs 1.42.13 (17-May-2015)

Resizing the filesystem on container.img to 393216 (4k) blocks.

The filesystem on container.img is now 393216 (4k) blocks long.

Image is done: container.img


$ ls -lh container.img

-rw-rw-r-- 1 vanessa vanessa 1.5G Oct  2 18:48 container.img
</pre></div>
</div>
<p>Similar to the create sub-command, you can override the default size
increase (which is 768MiB) by using the <code class="docutils literal notranslate"><span class="pre">--size</span></code> option.</p>
</div>
</div>
<div class="section" id="image-import">
<span id="id40"></span><h3>image.import<a class="headerlink" href="#image-import" title="Permalink to this headline">¶</a></h3>
<p id="sec-imageimport">Singularity import is essentially taking a dump of files and folders
and adding them to your image. This works for local compressed things
(e.g., tar.gz) but also for docker image layers that you don’t have on
your system. As of version 2.3, import of docker layers includes the
environment and metadata without needing sudo. It’s generally very
intuitive.</p>
<p>As an example, here is a common use case: wanting to import a Docker
image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity image.import container.img docker://ubuntu:latest
</pre></div>
</div>
</div>
<div class="section" id="image-create">
<span id="id41"></span><h3>image.create<a class="headerlink" href="#image-create" title="Permalink to this headline">¶</a></h3>
<p id="sec-imagecreate">A Singularity image, which can be referred to as a “container,” is a
single file that contains a virtual file system. As of Singularity
2.4, we strongly recommend that you build (create and install) an
image using <a class="reference internal" href="build_a_container.html#build-a-container"><span class="std std-ref">build</span></a>. If you have reason to create an empty image, or use
create for any other reason, the original <code class="docutils literal notranslate"><span class="pre">create</span></code> command is replaced with a
more specific <code class="docutils literal notranslate"><span class="pre">image.create</span></code>. After creating an image you can install an operating
system, applications, and save meta-data with it.</p>
<p>Whereas Docker assembles images from layers that are stored on your
computer (viewed with the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">history</span></code> command), a Singularity image is just one
file that can sit on your Desktop, in a folder on your cluster, or
anywhere. Having Singularity containers housed within a single image
file greatly simplifies management tasks such as sharing, copying, and
branching your containers. It also means that standard Linux file
system concepts like permissions, ownership, and ACLs apply to the
container (e.g. I can give read only access to a colleague, or block
access completely with a simple <code class="docutils literal notranslate"><span class="pre">chmod</span></code> command).</p>
<div class="section" id="creating-a-new-blank-singularity-container-image">
<h4>Creating a new blank Singularity container image<a class="headerlink" href="#creating-a-new-blank-singularity-container-image" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Singularity will create a default container image of 768MiB using the
following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity image.create container.img

Creating empty 768MiB image file: container.img

Formatting image with ext3 file system

Image is done: container.img
</pre></div>
</div>
<p>How big is it?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ du -sh container.img

29M     container.img
</pre></div>
</div>
<p>Create will make an <code class="docutils literal notranslate"><span class="pre">ext3</span></code> filesystem. Let’s create and import a docker base
(the pre-2.4 way with two commands), and then compare to just building
(one command) from the same base.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity create container.img

sudo singularity bootstrap container.img docker://ubuntu


...


$ du -sh container.img

769M
</pre></div>
</div>
<p>Prior to 2.4, you would need to provide a <code class="docutils literal notranslate"><span class="pre">--size</span></code> to change from the default:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity create --size 2048 container2.img

Initializing Singularity image subsystem

Opening image file: container2.img

Creating 2048MiB image

Binding image to loop

Creating file system within image

Image is done: container2.img


$ ls -lh container*.img

-rwxr-xr-x 1 user group 2.1G Apr 15 11:34 container2.img

-rwxr-xr-x 1 user group 769M Apr 15 11:11 container.img
</pre></div>
</div>
<p>Now let’s compare to if we just built, without needing to specify a
size.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo singularity build container.simg docker://ubuntu


...


du -sh container.simg

45M container.simg
</pre></div>
</div>
</div></blockquote>
<p>Quite a difference! And one command instead of one.</p>
<div class="section" id="overwriting-an-image-with-a-new-one">
<h5>Overwriting an image with a new one<a class="headerlink" href="#overwriting-an-image-with-a-new-one" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><p>For any commands that If you have already created an image and wish to
overwrite it, you can do so with the <code class="docutils literal notranslate"><span class="pre">--force</span></code> option.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity image.create container.img

ERROR: Image file exists, not overwriting.



$ singularity image.create --force container.img

Creating empty 768MiB image file: container.img

Formatting image with ext3 file system

Image is done: container.img
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;GodLoveD</span></code> has provided a nice interactive demonstration of creating an image (pre
2.4).</p>
</div></blockquote>
</div>
</div>
</div>
</div>
<div class="section" id="instance-command-group">
<span id="id42"></span><h2>Instance Command Group<a class="headerlink" href="#instance-command-group" title="Permalink to this headline">¶</a></h2>
<div class="section" id="instance-start">
<span id="sec-instances"></span><h3>instance.start<a class="headerlink" href="#instance-start" title="Permalink to this headline">¶</a></h3>
<p id="sec-instancestart">New in Singularity version 2.4 you can use the <code class="docutils literal notranslate"><span class="pre">instance</span></code> command group to run
instances of containers in the background. This is useful for running
services like databases and web servers. The <code class="docutils literal notranslate"><span class="pre">instance.start</span></code> command lets you initiate a
named instance in the background.</p>
<div class="section" id="id43">
<h4>Overview<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p>To initiate a named instance of a container, you must call the <code class="docutils literal notranslate"><span class="pre">instance.start</span></code> command
with 2 arguments: the name of the container that you want to start and a
unique name for an instance of that container. Once the new instance is
running, you can join the container’s namespace using a URI style syntax
like so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell instance://&lt;instance_name&gt;
</pre></div>
</div>
<p>You can specify options such as bind mounts, overlays, or custom
namespaces when you initiate a new instance of a container with
instance.start. These options will persist as long as the container
runs.</p>
<p>For a complete list of options see the output of:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>singularity help instance.start
</pre></div>
</div>
</div>
<div class="section" id="id44">
<h4>Examples<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>These examples use a container from Singularity Hub, but you can use
local containers or containers from Docker Hub as well. For a more
detailed look at <code class="docutils literal notranslate"><span class="pre">instance</span></code> usage see <a class="reference internal" href="running_services.html#running-services"><span class="std std-ref">Running Instances</span></a>.</p>
<div class="section" id="start-an-instance-called-cow1-from-a-container-on-singularity-hub">
<h5>Start an instance called cow1 from a container on Singularity Hub<a class="headerlink" href="#start-an-instance-called-cow1-from-a-container-on-singularity-hub" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.start shub://GodloveD/lolcow cow1
</pre></div>
</div>
</div>
<div class="section" id="start-an-interactive-shell-within-the-instance-that-you-just-started">
<h5>Start an interactive shell within the instance that you just started<a class="headerlink" href="#start-an-interactive-shell-within-the-instance-that-you-just-started" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity shell instance://cow1

Singularity GodloveD-lolcow-master.img:~&gt; ps -ef

UID        PID  PPID  C STIME TTY          TIME CMD

ubuntu       1     0  0 20:03 ?        00:00:00 singularity-instance: ubuntu [cow1]

ubuntu       3     0  0 20:04 pts/0    00:00:00 /bin/bash --norc

ubuntu       4     3  0 20:04 pts/0    00:00:00 ps -ef

Singularity GodloveD-lolcow-master.img:~&gt; exit
</pre></div>
</div>
</div>
<div class="section" id="execute-the-runscript-within-the-instance">
<h5>Execute the runscript within the instance<a class="headerlink" href="#execute-the-runscript-within-the-instance" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity run instance://cow1

 _________________________________________

/ Clothes make the man. Naked people have \

| little or no influence on society.      |

|                                         |

\ -- Mark Twain                           /

 -----------------------------------------

        \   ^__^

         \  (oo)\_______

            (__)\       )\/\

                ||----w |

                ||     ||
</pre></div>
</div>
</div>
<div class="section" id="run-a-command-within-a-running-instance">
<h5>Run a command within a running instance<a class="headerlink" href="#run-a-command-within-a-running-instance" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity exec instance://cow1 cowsay &quot;I like blending into the background&quot;

 _____________________________________

&lt; I like blending into the background &gt;

 -------------------------------------

        \   ^__^

         \  (oo)\_______

            (__)\       )\/\

                ||----w |

                ||     ||
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="instance-list">
<h3>instance.list<a class="headerlink" href="#instance-list" title="Permalink to this headline">¶</a></h3>
<p id="sec-instancelist">New in Singularity version 2.4 you can use the <code class="docutils literal notranslate"><span class="pre">instance</span></code> command group to run
instances of containers in the background. This is useful for running
services like databases and web servers. The <code class="docutils literal notranslate"><span class="pre">instance.list</span></code> command lets you keep track
of the named instances running in the background.</p>
<div class="section" id="id45">
<h4>Overview<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<p>After initiating one or more named instances to run in the background
with the <code class="docutils literal notranslate"><span class="pre">instance.start</span></code> command you can list them with the <code class="docutils literal notranslate"><span class="pre">instance.list</span></code> command.</p>
</div>
<div class="section" id="id46">
<h4>Examples<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<p>These examples use a container from Singularity Hub, but you can use
local containers or containers from Docker Hub as well. For a more
detailed look at <code class="docutils literal notranslate"><span class="pre">instance</span></code> usage see <a class="reference internal" href="running_services.html#running-services"><span class="std std-ref">Running Instances</span></a>.</p>
<div class="section" id="start-a-few-named-instances-from-containers-on-singularity-hub">
<h5>Start a few named instances from containers on Singularity Hub<a class="headerlink" href="#start-a-few-named-instances-from-containers-on-singularity-hub" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.start shub://GodloveD/lolcow cow1

$ singularity instance.start shub://GodloveD/lolcow cow2

$ singularity instance.start shub://vsoch/hello-world hiya
</pre></div>
</div>
</div>
<div class="section" id="list-running-instances">
<h5>List running instances<a class="headerlink" href="#list-running-instances" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.list

DAEMON NAME      PID      CONTAINER IMAGE

cow1             20522    /home/ubuntu/GodloveD-lolcow-master.img

cow2             20558    /home/ubuntu/GodloveD-lolcow-master.img

hiya             20595    /home/ubuntu/vsoch-hello-world-master.img
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="instance-stop">
<h3>instance.stop<a class="headerlink" href="#instance-stop" title="Permalink to this headline">¶</a></h3>
<p id="sec-instancestop">New in Singularity version 2.4 you can use the <code class="docutils literal notranslate"><span class="pre">instance</span></code> command group to run
instances of containers in the background. This is useful for running
services like databases and web servers. The <code class="docutils literal notranslate"><span class="pre">instance.stop</span></code> command lets you stop
instances once you are finished using them</p>
<div class="section" id="id47">
<h4>Overview<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p>After initiating one or more named instances to run in the background
with the <code class="docutils literal notranslate"><span class="pre">instance.start</span></code> command you can stop them with the <code class="docutils literal notranslate"><span class="pre">instance.stop</span></code> command.</p>
</div>
<div class="section" id="id48">
<h4>Examples<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>These examples use a container from Singularity Hub, but you can use
local containers or containers from Docker Hub as well. For a more
detailed look at <code class="docutils literal notranslate"><span class="pre">instance</span></code> usage see <a class="reference internal" href="running_services.html#running-services"><span class="std std-ref">Running Instances</span></a>.</p>
<div class="section" id="id49">
<h5>Start a few named instances from containers on Singularity Hub<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.start shub://GodloveD/lolcow cow1

$ singularity instance.start shub://GodloveD/lolcow cow2

$ singularity instance.start shub://vsoch/hello-world hiya
</pre></div>
</div>
</div>
<div class="section" id="stop-a-single-instance">
<h5>Stop a single instance<a class="headerlink" href="#stop-a-single-instance" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.stop cow1

Stopping cow1 instance of /home/ubuntu/GodloveD-lolcow-master.img (PID=20522)
</pre></div>
</div>
</div>
<div class="section" id="stop-all-running-instances">
<h5>Stop all running instances<a class="headerlink" href="#stop-all-running-instances" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity instance.stop --all

Stopping cow2 instance of /home/ubuntu/GodloveD-lolcow-master.img (PID=20558)

Stopping hiya instance of /home/ubuntu/vsoch-hello-world-master.img (PID=20595)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="deprecated">
<h2>Deprecated<a class="headerlink" href="#deprecated" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bootstrap">
<span id="id50"></span><h3>bootstrap<a class="headerlink" href="#bootstrap" title="Permalink to this headline">¶</a></h3>
<p id="sec-bootstrap">Bootstrapping was the original way (for Singularity versions prior to
2.4) to install an operating system and then configure it appropriately
for a specified need. Bootstrap is very similar to build, except that it
by default uses an <a class="reference external" href="https://en.wikipedia.org/wiki/Ext3">ext3</a> filesystem and allows for writability. The
images unfortunately are not immutable in this way, and can degrade over
time. As of 2.4, bootstrap is still supported for Singularity, however
we encourage you to use <a class="reference internal" href="build_a_container.html#build-a-container"><span class="std std-ref">build</span></a> instead.</p>
<div class="section" id="quick-start">
<h4>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h4>
<p>A bootstrap is done based on a Singularity recipe file (a text file
called Singularity) that describes how to specifically build the
container. Here we will overview the sections, best practices, and a
quick example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity bootstrap

USAGE: singularity [...] bootstrap &lt;container path&gt; &lt;definition file&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;container</span> <span class="pre">path&gt;</span></code> is the path to the Singularity image file, and the <code class="docutils literal notranslate"><span class="pre">&lt;definition</span> <span class="pre">file&gt;</span></code> is the location
of the definition file (the recipe) we will use to create this
container. The process of building a container should always be done
by root so that the correct file ownership and permissions are
maintained. Also, so installation programs check to ensure they are
the root user before proceeding. The bootstrap process may take
anywhere from one minute to one hour depending on what needs to be
done and how fast your network connection is.</p>
<p>Let’s continue with our quick start example. Here is your spec file, <code class="docutils literal notranslate"><span class="pre">Singularity</span></code> ,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bootstrap:docker

From:ubuntu:latest
</pre></div>
</div>
<p>You next create an image:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity image.create ubuntu.img

Initializing Singularity image subsystem

Opening image file: ubuntu.img

Creating 768MiB image

Binding image to loop

Creating file system within image

Image is done: ubuntu.img
</pre></div>
</div>
<p>and finally run the bootstrap command, pointing to your image ( <code class="docutils literal notranslate"><span class="pre">&lt;container</span> <span class="pre">path&gt;</span></code> ) and
the file Singularity ( <code class="docutils literal notranslate"><span class="pre">&lt;definition</span> <span class="pre">file&gt;</span></code> ).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo singularity bootstrap ubuntu.img Singularity

Sanitizing environment

Building from bootstrap definition recipe

Adding base Singularity environment to container

Docker image path: index.docker.io/library/ubuntu:latest

Cache folder set to /root/.singularity/docker

[5/5] |===================================| 100.0%

Exploding layer: sha256:b6f892c0043b37bd1834a4a1b7d68fe6421c6acbc7e7e63a4527e1d379f92c1b.tar.gz

Exploding layer: sha256:55010f332b047687e081a9639fac04918552c144bc2da4edb3422ce8efcc1fb1.tar.gz

Exploding layer: sha256:2955fb827c947b782af190a759805d229cfebc75978dba2d01b4a59e6a333845.tar.gz

Exploding layer: sha256:3deef3fcbd3072b45771bd0d192d4e5ff2b7310b99ea92bce062e01097953505.tar.gz

Exploding layer: sha256:cf9722e506aada1109f5c00a9ba542a81c9e109606c01c81f5991b1f93de7b66.tar.gz

Exploding layer: sha256:fe44851d529f465f9aa107b32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz

Finalizing Singularity container
</pre></div>
</div>
<p>Notice that bootstrap does require sudo. If you do an import, with a
docker uri for example, you would see a similar flow, but the calling
user would be you, and the cache your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ singularity image.create ubuntu.img

singularity import ubuntu.img docker://ubuntu:latest

Docker image path: index.docker.io/library/ubuntu:latest

Cache folder set to /home/vanessa/.singularity/docker

Importing: base Singularity environment

Importing: /home/vanessa/.singularity/docker/sha256:b6f892c0043b37bd1834a4a1b7d68fe6421c6acbc7e7e63a4527e1d379f92c1b.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:55010f332b047687e081a9639fac04918552c144bc2da4edb3422ce8efcc1fb1.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:2955fb827c947b782af190a759805d229cfebc75978dba2d01b4a59e6a333845.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:3deef3fcbd3072b45771bd0d192d4e5ff2b7310b99ea92bce062e01097953505.tar.gz

Importing: /home/vanessa/.singularity/docker/sha256:cf9722e506aada1109f5c00a9ba542a81c9e109606c01c81f5991b1f93de7b66.tar.gz

Importing: /home/vanessa/.singularity/metadata/sha256:fe44851d529f465f9aa107b32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz
</pre></div>
</div>
<p>For details and best practices for creating your Singularity recipe, <a class="reference internal" href="container_recipes.html#container-recipes"><span class="std std-ref">read about them here</span></a>.</p>
</div>
</div>
</div>
</div>


           </div>

          </div>
          <footer>

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">

        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>


        <a href="troubleshooting.html" class="btn btn-neutral" title="Troubleshooting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Singularity.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>



  <script type="text/javascript" src="_static/js/footer.js"></script>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.6.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>



  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
